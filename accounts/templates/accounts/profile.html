{% extends "dashboardhome.html" %}

{% block title %}My Profile - Lupify{% endblock %}

{% block extra_head %}
{{ block.super }}
<style>
    .profile-page {
        max-width: 780px;
        margin: 0 auto;
        padding: 36px 32px;
        border-radius: 1rem;
        background: hsl(var(--card));
        border: 1px solid hsl(var(--border));
        box-shadow: var(--shadow-card);
    }

    .profile-header {
        display: flex;
        gap: 1.25rem;
        align-items: center;
        margin-bottom: 2rem;
    }

    .profile-avatar-large {
        width: 96px;
        height: 96px;
        border-radius: 9999px;
        background: hsl(var(--secondary));
        color: hsl(var(--secondary-foreground));
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        font-weight: 600;
    }

    .profile-avatar-large img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: inherit;
        display: block;
    }

    .profile-header h1 {
        margin: 0;
    }

    .profile-header p {
        margin: 0.15rem 0 0;
        color: hsl(var(--muted-foreground));
        font-size: 0.95rem;
    }

    .message-stack {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        margin-bottom: 1.25rem;
    }

    .flash-message {
        padding: 0.9rem 1rem;
        border-radius: 0.85rem;
        font-weight: 500;
        border: 1px solid transparent;
    }

    .flash-message.success {
        background: hsla(145, 63%, 47%, 0.12);
        border-color: hsl(145, 63%, 47% / 0.4);
        color: hsl(145, 63%, 47%);
    }

    .flash-message.error {
        background: hsla(348, 89%, 55%, 0.12);
        border-color: hsl(348, 89%, 55% / 0.4);
        color: hsl(348, 89%, 55%);
    }

    .profile-form {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 1rem;
    }

    .form-group label {
        display: block;
        margin-bottom: 0.35rem;
        font-size: 0.75rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: hsl(var(--muted-foreground));
    }

    .profile-form input,
    .profile-form textarea,
    .profile-form select {
        width: 100%;
        padding: 0.85rem 1rem;
        border-radius: var(--radius);
        border: 1px solid hsl(var(--border));
        background: hsl(var(--secondary) / 0.75);
        color: hsl(var(--foreground));
        font-family: inherit;
        font-size: 0.95rem;
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }

    .profile-form input:focus,
    .profile-form textarea:focus,
    .profile-form select:focus {
        outline: none;
        border-color: hsl(var(--primary));
        box-shadow: 0 0 0 2px hsl(var(--primary) / 0.25);
        background: hsl(var(--card));
    }

    .profile-form textarea {
        min-height: 140px;
        resize: vertical;
    }

    .form-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        margin-top: 1rem;
    }

    .form-help {
        font-size: 0.85rem;
        color: hsl(var(--muted-foreground));
    }

    @media (max-width: 640px) {
        .profile-page {
            padding: 28px 18px;
        }

        .profile-header {
            flex-direction: column;
            align-items: flex-start;
        }

        .form-actions {
            flex-direction: column;
        }
    }
</style>
{% endblock %}

{% block main_content %}
<div class="profile-page">
    <div class="profile-header">
        <div class="profile-avatar-large">
            {% if request.user.avatar %}
                <img src="{{ request.user.avatar.url }}" alt="{{ request.user.username }}'s avatar">
            {% else %}
                {{ request.user.username|slice:":1"|upper }}
            {% endif %}
        </div>
        <div>
            <h1>Profile Settings</h1>
            <p>Keep your contact info and bio up to date for the community.</p>
        </div>
    </div>

    {% if messages %}
    <div class="message-stack">
        {% for message in messages %}
            <div class="flash-message {{ message.tags }}">{{ message }}</div>
        {% endfor %}
    </div>
    {% endif %}

    <form method="post" enctype="multipart/form-data" class="profile-form">
        {% csrf_token %}
        {{ form.non_field_errors }}
        <div class="form-grid">
            <div class="form-group">
                {{ form.avatar.label_tag }}
                {{ form.avatar }}
                {{ form.avatar.errors }}
                <p class="form-help">Upload a square image for best results.</p>
            </div>
            <div class="form-group">
                {{ form.username.label_tag }}
                {{ form.username }}
                {{ form.username.errors }}
            </div>
            <div class="form-group">
                {{ form.email.label_tag }}
                {{ form.email }}
                {{ form.email.errors }}
            </div>
            <div class="form-group">
                {{ form.phone_number.label_tag }}
                {{ form.phone_number }}
                {{ form.phone_number.errors }}
            </div>
        </div>

        <div class="form-group">
            {{ form.bio.label_tag }}
            {{ form.bio }}
            {{ form.bio.errors }}
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Save changes</button>
            <a href="{% url 'dashboard_home' %}" class="btn btn-ghost">Cancel</a>
        </div>
    </form>
</div>
{% endblock %}
