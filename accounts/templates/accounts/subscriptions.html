{% extends "dashboardhome.html" %}

{% block title %}Subscriptions - Lupify{% endblock %}

{% block content %}
<div class="feed-wrapper">

    <!-- Header -->
    <div class="feed-header">
        <div style="display: flex; align-items: center; gap: 12px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bookmark-check-icon lucide-bookmark-check"><path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z"/><path d="m9 10 2 2 4-4"/></svg>
            <h2>Your Subscriptions & Bookmarks</h2>
        </div>
        <div class="subscription-tabs">
            <button class="tab-btn active" data-target="community-posts">Community Posts</button>
            <button class="tab-btn" data-target="blog-posts">Blog Articles</button>
            <button class="tab-btn" data-target="bookmarks" style="display: flex; align-items: center; gap: 6px;"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" class="lucide lucide-bookmark-check-icon lucide-bookmark-check"><path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z"/><path d="m9 10 2 2 4-4"/></svg>Bookmarks</button>
        </div>
    </div>

    {% if subscribed_communities or subscribed_authors %}
    <div class="subscription-list">
        {% for sub in subs %}
        <div class="subscription-card" data-type="{% if sub.community %}community{% elif sub.author %}author{% endif %}">
            {% if sub.community %}
                <h4>{{ sub.community.name }}</h4>
                <p class="card-meta">{{ sub.community.members.count }} <span>members</span></p>
                {% if sub.community.community_image %}<img src="{{ sub.community.community_image.url }}" alt="{{ sub.community.name }}" class="subscription-thumb">{% endif %}
                {% if request.user in sub.community.members.all %}
                    <a class="unsubscribe-btn" href="{% url 'toggle_join_community' sub.community.id %}">Leave</a>
                {% else %}
                    <a class="unsubscribe-btn" href="{% url 'toggle_subscription' sub.community.id %}">Unsubscribe</a>
                {% endif %}
            {% elif sub.author %}
                <h4>{{ sub.author.username }}</h4>
                <p class="card-meta">Author {% if sub.author.is_verified %}<span class="verified-badge">âœ“</span>{% endif %}</p>
                {% if sub.author.avatar %}<img src="{{ sub.author.avatar.url }}" alt="{{ sub.author.username }}" class="subscription-thumb">{% endif %}
                <a class="unsubscribe-btn" href="{% url 'toggle_subscription_author' sub.author.id %}">Unsubscribe</a>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    <!-- Tab Content -->
    <div class="tab-content">
        <!-- Community Posts Tab -->
        <div id="community-posts" class="tab-panel active">
            {% if community_posts %}
                {% for post in community_posts %}
                <article class="post-card full-bleed">
                    <div class="post-card-wrapper">
                        <div class="post-content">
                            <div class="author-line">
                                <span style="font-weight:600;color:var(--secondary-text);font-size:0.9rem;">{{ post.community.name }}</span>
                            </div>
                            <h3 class="post-title"><a href="{% url 'community_post_detail' post.id %}">{{ post.title }}</a></h3>
                            <div class="engage-row">
                                <div class="engage-left">
                                    <div class="engage-controls" style="display:flex;gap:12px;align-items:center;">
                                        <button class="like-btn" data-post-id="{{ post.id }}" data-post-type="community" style="border:none;background:none;cursor:pointer;padding:0;display:flex;align-items:center;gap:6px;color:var(--secondary-text);font-size:0.9rem;transition:color 0.2s;">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-thumbs-up-icon lucide-thumbs-up"><path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z"/><path d="M7 10v12"/></svg>
                                            <span class="like-count">{{ post.likes.count }}</span>
                                        </button>
                                        <button class="comment-btn" data-post-id="{{ post.id }}" data-post-type="community" style="border:none;background:none;cursor:pointer;padding:0;display:flex;align-items:center;gap:6px;color:var(--secondary-text);font-size:0.9rem;transition:color 0.2s;">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-square-icon lucide-message-square"><path d="M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z"/></svg>
                                            <span class="comment-count">{{ post.comments.count }}</span>
                                        </button>
                                        <button class="bookmark-btn" data-post-id="{{ post.id }}" data-post-type="community" style="border:none;background:none;cursor:pointer;padding:0;display:flex;align-items:center;gap:6px;color:var(--secondary-text);font-size:0.9rem;transition:color 0.2s;">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bookmark-check-icon lucide-bookmark-check"><path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z"/><path d="m9 10 2 2 4-4"/></svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <p style="color:var(--secondary-text);margin-top:8px;line-height:1.5;">{{ post.content|truncatewords:30 }}</p>
                        </div>
                    </div>
                </article>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="opacity: 0.5; margin: 0 auto 16px; display: block;">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <p>No posts from your subscribed communities yet.</p>
                </div>
            {% endif %}
        </div>

        <!-- Blog Posts Tab -->
        <div id="blog-posts" class="tab-panel">
            {% if author_posts %}
                {% for blog in author_posts %}
                <article class="post-card full-bleed">
                    <div class="post-card-wrapper">
                        <div class="post-content">
                            <div class="author-line">
                                <span style="font-weight:600;color:var(--secondary-text);font-size:0.9rem;">By {{ blog.author.get_full_name|default:blog.author.username }}</span>
                            </div>
                            <h3 class="post-title"><a href="{% url 'post_detail' blog.id %}">{{ blog.title }}</a></h3>
                            <div class="engage-row">
                                <div class="engage-left">
                                    <div class="engage-controls" style="display:flex;gap:12px;align-items:center;">
                                        <button class="like-btn" data-post-id="{{ blog.id }}" data-post-type="blog" style="border:none;background:none;cursor:pointer;padding:0;display:flex;align-items:center;gap:6px;color:var(--secondary-text);font-size:0.9rem;transition:color 0.2s;">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-thumbs-up-icon lucide-thumbs-up"><path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z"/><path d="M7 10v12"/></svg>
                                            <span class="like-count">{{ blog.likes.count }}</span>
                                        </button>
                                        <button class="comment-btn" data-post-id="{{ blog.id }}" data-post-type="blog" style="border:none;background:none;cursor:pointer;padding:0;display:flex;align-items:center;gap:6px;color:var(--secondary-text);font-size:0.9rem;transition:color 0.2s;">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-square-icon lucide-message-square"><path d="M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z"/></svg>
                                            <span class="comment-count">{{ blog.comments.count }}</span>
                                        </button>
                                        <button class="bookmark-btn" data-post-id="{{ blog.id }}" data-post-type="blog" style="border:none;background:none;cursor:pointer;padding:0;display:flex;align-items:center;gap:6px;color:var(--secondary-text);font-size:0.9rem;transition:color 0.2s;">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bookmark-check-icon lucide-bookmark-check"><path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z"/><path d="m9 10 2 2 4-4"/></svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <p style="color:var(--secondary-text);margin-top:8px;line-height:1.5;">{{ blog.content|truncatewords:30 }}</p>
                        </div>
                    </div>
                </article>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="opacity: 0.5; margin: 0 auto 16px; display: block;">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                        <path d="M6.5 2H20a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H6.5a2.5 2.5 0 0 1 0-5H20"></path>
                    </svg>
                    <p>No blogs from your subscribed authors yet.</p>
                </div>
            {% endif %}
        </div>

        <!-- Bookmarks Tab -->
        <div id="bookmarks" class="tab-panel">
            {% if user.bookmarked_community_posts.all %}
                <div class="bookmarks-section">
                    <h5 style="margin-bottom: 16px; color: var(--text-dark);">Community Posts</h5>
                    {% for post in user.bookmarked_community_posts.all %}
                    <article class="post-card full-bleed">
                        <div class="post-card-wrapper">
                            <div class="post-content">
                                <div class="author-line">
                                    <span style="font-weight:600;color:var(--secondary-text);font-size:0.9rem;">{{ post.community.name }}</span>
                                </div>
                                <h3 class="post-title"><a href="{% url 'community_post_detail' post.id %}">{{ post.title }}</a></h3>
                                <div class="engage-row">
                                    <div class="engage-left">
                                        <div class="engage-controls" style="display:flex;gap:12px;align-items:center;">
                                            <button class="like-btn" data-post-id="{{ post.id }}" data-post-type="community" style="border:none;background:none;cursor:pointer;padding:0;display:flex;align-items:center;gap:6px;color:var(--secondary-text);font-size:0.9rem;transition:color 0.2s;">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-thumbs-up-icon lucide-thumbs-up"><path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z"/><path d="M7 10v12"/></svg>
                                                <span class="like-count">{{ post.likes.count }}</span>
                                            </button>
                                            <button class="comment-btn" data-post-id="{{ post.id }}" data-post-type="community" style="border:none;background:none;cursor:pointer;padding:0;display:flex;align-items:center;gap:6px;color:var(--secondary-text);font-size:0.9rem;transition:color 0.2s;">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-square-icon lucide-message-square"><path d="M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z"/></svg>
                                                <span class="comment-count">{{ post.comments.count }}</span>
                                            </button>
                                            <button class="bookmark-btn" data-post-id="{{ post.id }}" data-post-type="community" style="border:none;background:none;cursor:pointer;padding:0;display:flex;align-items:center;gap:6px;color:var(--secondary-text);font-size:0.9rem;transition:color 0.2s;">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bookmark-check-icon lucide-bookmark-check"><path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z"/><path d="m9 10 2 2 4-4"/></svg>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <p style="color:var(--secondary-text);margin-top:8px;line-height:1.5;">{{ post.content|truncatewords:30 }}</p>
                            </div>
                        </div>
                    </article>
                    {% endfor %}
                </div>
            {% endif %}

            {% if user.bookmarked_posts.all %}
                <div class="bookmarks-section">
                    <h5 style="margin-bottom: 16px; color: var(--text-dark);">Blog Articles</h5>
                    {% for blog in user.bookmarked_posts.all %}
                    <article class="post-card full-bleed">
                        <div class="post-card-wrapper">
                            <div class="post-content">
                                <div class="author-line">
                                    <span style="font-weight:600;color:var(--secondary-text);font-size:0.9rem;">By {{ blog.author.get_full_name|default:blog.author.username }}</span>
                                </div>
                                <h3 class="post-title"><a href="{% url 'post_detail' blog.id %}">{{ blog.title }}</a></h3>
                                <div class="engage-row">
                                    <div class="engage-left">
                                        <div class="engage-controls" style="display:flex;gap:12px;align-items:center;">
                                            <button class="like-btn" data-post-id="{{ blog.id }}" data-post-type="blog" style="border:none;background:none;cursor:pointer;padding:0;display:flex;align-items:center;gap:6px;color:var(--secondary-text);font-size:0.9rem;transition:color 0.2s;">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-thumbs-up-icon lucide-thumbs-up"><path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z"/><path d="M7 10v12"/></svg>
                                                <span class="like-count">{{ blog.likes.count }}</span>
                                            </button>
                                            <button class="comment-btn" data-post-id="{{ blog.id }}" data-post-type="blog" style="border:none;background:none;cursor:pointer;padding:0;display:flex;align-items:center;gap:6px;color:var(--secondary-text);font-size:0.9rem;transition:color 0.2s;">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-square-icon lucide-message-square"><path d="M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z"/></svg>
                                                <span class="comment-count">{{ blog.comments.count }}</span>
                                            </button>
                                            <button class="bookmark-btn" data-post-id="{{ blog.id }}" data-post-type="blog" style="border:none;background:none;cursor:pointer;padding:0;display:flex;align-items:center;gap:6px;color:var(--secondary-text);font-size:0.9rem;transition:color 0.2s;">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bookmark-check-icon lucide-bookmark-check"><path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z"/><path d="m9 10 2 2 4-4"/></svg>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <p style="color:var(--secondary-text);margin-top:8px;line-height:1.5;">{{ blog.content|truncatewords:30 }}</p>
                            </div>
                        </div>
                    </article>
                    {% endfor %}
                </div>
            {% endif %}

            {% if not user.bookmarked_community_posts.all and not user.bookmarked_posts.all %}
                <div class="empty-state">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="opacity: 0.5; margin: 0 auto 16px; display: block;">
                        <path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <p>You haven't bookmarked anything yet. Start bookmarking posts to save them here!</p>
                </div>
            {% endif %}
        </div>
    </div>

    {% else %}
    <div class="empty-state" style="padding: 60px 20px; text-align: center;">
        <p style="font-size: 1.1rem;">You haven't subscribed to any communities or authors yet.</p>
        <p style="color: var(--secondary-text); margin-top: 8px;">Explore communities and follow authors to see their content here.</p>
    </div>
    {% endif %}
</div>

<style>
/* Tabs */
.subscription-tabs {
    display: flex;
    gap: 1rem;
    margin-top: 0.5rem;
    margin-bottom: 1rem;
}

.feed-wrapper { padding: 20px; }

.feed-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; }
.feed-header h2 { margin:0; font-size:1.5rem; }

.subscription-tabs { align-items:center; }

.tab-btn {
    padding: 0.6rem 1.2rem;
    background: var(--card-bg);
    border: 1px solid var(--primary);
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
    transition: background 0.2s;
}

.tab-btn.active {
    background: var(--primary);
    color: #fff;
}

.tab-btn:hover {
    background: var(--primary-dark);
    color: #fff;
}

.tab-panel { display: none; }
.tab-panel.active { display: block; }

.subscription-list {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.subscription-card {
    background: var(--card-bg);
    box-shadow: var(--card-shadow);
    padding: 1.2rem 1.5rem;
    border-radius: 12px;
    flex: 1 1 250px;
    min-width: 250px;
}

.subscription-card:hover { transform: translateY(-4px); box-shadow: 0 12px 30px rgba(2,6,23,0.08); }

.subscription-thumb { width:64px; height:64px; object-fit:cover; border-radius:8px; margin-top:8px; }

.subscription-card h4 { margin:0 0 6px 0; }

.subscription-list { align-items: flex-start; }

.unsubscribe-btn {
    padding: 0.5rem 1rem;
    background: var(--primary);
    color: #fff;
    border-radius: 8px;
    text-decoration: none;
    font-weight: bold;
}

.post-card { 
    background: var(--card-bg);
    box-shadow: var(--card-shadow);
    padding: 1rem 1.2rem;
    margin-bottom: 1rem;
    border-radius: 12px;
}
.post-card-subscription { background: var(--card-bg); box-shadow: var(--card-shadow); padding: 1rem; border-radius: 12px; margin-bottom: 12px; }
.post-card h4 { margin-bottom: 0.5rem; }
.post-card p { color: var(--secondary-text); margin-bottom: 0.5rem; }
.post-card a { color: var(--primary); font-weight: 600; text-decoration: none; }

.no-subs {
    font-size: 1rem;
    color: var(--secondary-text);
    text-align: center;
    margin-top: 1rem;
}
</style>
</style>

<script>
const tabs = document.querySelectorAll('.tab-btn');
const panels = document.querySelectorAll('.tab-panel');

tabs.forEach(tab => {
    tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');

        const target = tab.dataset.target;
        panels.forEach(panel => {
            panel.classList.toggle('active', panel.id === target);
        });
    });
});

// AJAX Action Handlers
function getCSRFToken() {
    let token = '';
    const cookies = document.cookie.split(';');
    for (let cookie of cookies) {
        cookie = cookie.trim();
        if (cookie.startsWith('csrftoken=')) {
            token = cookie.substring('csrftoken='.length);
            break;
        }
    }
    return token || document.querySelector('[name=csrfmiddlewaretoken]')?.value || '';
}

document.querySelectorAll('.like-btn').forEach(btn => {
    btn.addEventListener('click', async (e) => {
        e.preventDefault();
        const postId = btn.dataset.postId;
        const postType = btn.dataset.postType;
        const endpoint = postType === 'blog' ? `/posts/${postId}/like/` : `/communities/post/${postId}/like/`;
        
        try {
            const res = await fetch(endpoint, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCSRFToken(),
                    'Content-Type': 'application/json'
                }
            });
            if (res.ok) {
                const data = await res.json();
                const countEl = btn.querySelector('.like-count');
                if (countEl) countEl.textContent = data.like_count || 0;
                btn.style.color = data.is_liked ? 'var(--primary)' : 'var(--secondary-text)';
            }
        } catch (err) {
            console.error('Like failed:', err);
        }
    });
});

document.querySelectorAll('.bookmark-btn').forEach(btn => {
    btn.addEventListener('click', async (e) => {
        e.preventDefault();
        const postId = btn.dataset.postId;
        const postType = btn.dataset.postType;
        const endpoint = postType === 'blog' ? `/posts/${postId}/bookmark/` : `/communities/post/${postId}/bookmark/`;
        
        try {
            const res = await fetch(endpoint, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCSRFToken(),
                    'Content-Type': 'application/json'
                }
            });
            if (res.ok) {
                const data = await res.json();
                const svg = btn.querySelector('svg');
                if (data.is_bookmarked) {
                    btn.style.color = 'var(--primary)';
                    svg.setAttribute('class', 'lucide lucide-bookmark-check-icon lucide-bookmark-check');
                } else {
                    btn.style.color = 'var(--secondary-text)';
                    svg.setAttribute('class', 'lucide lucide-bookmark-icon lucide-bookmark');
                }
            }
        } catch (err) {
            console.error('Bookmark failed:', err);
        }
    });
});

document.querySelectorAll('.comment-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
        e.preventDefault();
        const postId = btn.dataset.postId;
        const postType = btn.dataset.postType;
        if (postType === 'blog') {
            window.location.href = `/posts/${postId}/#comments`;
        } else {
            window.location.href = `/communities/post/${postId}/#comments`;
        }
    });
});
</script>

{% endblock %}
